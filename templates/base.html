<!DOCTYPE html>
<html lang="{{ DEFAULT_LANG }}">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="{{ SITEURL }}/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="{{ SITEURL }}/theme/css/style.css">
  <!-- Dark mode syntax highlighting (default) -->
  <link rel="stylesheet" type="text/css" href="{{ SITEURL }}/theme/css/pygments-dark.css" id="pygments-dark">
  <!-- Light mode syntax highlighting -->
  <link rel="stylesheet" type="text/css" href="{{ SITEURL }}/theme/css/pygments-light.css" id="pygments-light" disabled>
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="{{ AUTHOR }}">
  <meta name="description" content="Father. Husband. Grows Product & Services. Permaculture. Founder https://www.remarkbox.com & https://www.makepostsell.com. Engineer. Computing Scientist. Gardener. I AM in a BEGINNING.">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/a11y-dark.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>

  {% if FEED_ALL_ATOM %}
  <link href="{{ FEED_DOMAIN }}/{{ FEED_ALL_ATOM }}" type="application/atom+xml" rel="alternate" title="{{ SITENAME }} Atom" />
  {% endif %}
  {% if FEED_ALL_RSS %}
  <link href="{{ FEED_DOMAIN }}/{{ FEED_ALL_RSS }}" type="application/rss+xml" rel="alternate" title="{{ SITENAME }} RSS" />
  {% endif %}

  {% block head %}
  {% endblock %}

  <title>
    {% block title %}{% endblock %}
    {{ SITENAME }}
  </title>

  <!-- Prevent flash of dark mode - must run before page renders -->
  <script>
    (function() {
      // Add js-enabled class to show theme toggle buttons
      document.documentElement.classList.add('js-enabled');

      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.documentElement.classList.add('light-mode');
        // Switch to light mode syntax highlighting
        document.getElementById('pygments-dark').disabled = true;
        document.getElementById('pygments-light').disabled = false;
      }
    })();
  </script>

  <script src="https://uncloseai.com/uncloseai.js" type="module"></script>
  {% include "modules/analytics.html" %}
</head>

<body{% block body_class %}{% endblock %}>
  <aside>
    <div id="user_meta">
      <a href="{{ SITEURL }}">
        {% if USER_LOGO_URL %}
        <img src="{{ USER_LOGO_URL }}" alt="logo" class="logo">
        {% else %}
        <img src="{{ SITEURL }}/theme/images/logo.png" alt="logo" class="logo">
        {% endif %}
      </a>
      <h2><a href="{{ SITEURL }}">{{ AUTHOR }}</a></h2>
      <p>{{ TAGLINE }}</p>

      <!-- Mobile navigation -->
      <div id="mobile-nav">
        <a href="{{ SITEURL }}/random.html">Random</a> &bull;
        <a href="{{ SITEURL }}/archives.html">Archives</a> &bull;
        {% if FEED_ALL_ATOM %}<a href="{{ FEED_DOMAIN }}/{{ FEED_ALL_ATOM }}">RSS</a> &bull;{% endif %}
        {% if FEED_ALL_RSS %}<a href="{{ FEED_DOMAIN }}/{{ FEED_ALL_RSS }}">RSS</a> &bull;{% endif %}
        <a href="{{ SITEURL }}/about/">About</a> &bull;
        <a href="{{ SITEURL }}/contact/">Contact</a>
        <form method="get" id="mobile-search" action="https://duckduckgo.com/">
          <input type="hidden" name="sites" value="{{ SITEURL }}"/>
          <input type="submit" value="Search" style="display: none;" />
          <input type="text" name="q" maxlength="255" placeholder="Search" id="search-box"/>
          <button id="mobile-theme-toggle" type="button" onclick="toggleTheme()">Light</button>
        </form>
      </div>

      <ul class="hidden-on-tablet">
	<br/>
	<div class="advert">

	<a href="https://www.remarkbox.com/" class="advert"><span class="avoidwrap">Your site deserves â€” </span><span class="avoidwrap">a beautiful comment section.</span></a><br/>
	  <span style="color: #006621;">[Ad] www.remarkbox.com</span> <br/>
	Demo on your site in 30s <span class="avoidwrap"> or try it out here!</span>
	<br/>

	</div>
        {% for title, link in MENUITEMS %}
        <li><a href="{{ link }}">{{ title }}</a></li>
        {% endfor %}
        {% if DISPLAY_PAGES_ON_MENU %}{% for p in pages %}
        <li><a href="{{ SITEURL }}/{{ p.url }}">{{ p.title }}</a></li>
        {% endfor %}{% endif %}
        {% for name, link in LINKS %}
        <li><a href="{{ link }}" target="_blank"><img src="{{ link }}/favicon.ico" style="width: 16px; border-radius:0px;vertical-align: -3px;"> {{ name }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <!-- <a href="{{ SITEURL }}">{{ SITEURL }}</a> &nbsp; &bull; &nbsp; -->
      <a href="{{ SITEURL }}/random.html">Random</a>
      &nbsp; &bull; &nbsp; <a href="{{ SITEURL }}/archives.html">Archives</a>
      {% if FEED_ALL_ATOM %}
      &nbsp; &bull; &nbsp; <a href="{{ FEED_DOMAIN }}/{{ FEED_ALL_ATOM }}">RSS</a>
      {% endif %}
      {% if FEED_ALL_RSS %}
      &nbsp; &bull; &nbsp; <a href="{{ FEED_DOMAIN }}/{{ FEED_ALL_RSS }}">RSS</a>
      {% endif %}
      &nbsp; &bull; &nbsp; <a href="{{ SITEURL }}/about/">About</a>
      &nbsp; &bull; &nbsp; <a href="{{ SITEURL }}/contact/">Contact</a>
      &nbsp; &bull; &nbsp;
      <form method="get" id="search" action="https://duckduckgo.com/" style="display: inline;">
          <input type="hidden" name="sites" value="{{ SITEURL }}"/>
          <input type="submit" value="Search" style="display: none;" />
          <input type="text" name="q" maxlength="255" placeholder="Search" id="search-box"/>
      </form>
      <button id="theme-toggle" type="button" onclick="toggleTheme()">Light</button>{% block header %}{% endblock header %}
    </header>

    <div id="main-content">
      {% block content %}
      {% endblock %}
    </div>

    <footer>
    {% block footer %}

    <img src="/uploads/profile/garden-profile.jpg" width="300px" style="float: left; margin-right: 40px; margin-bottom: 40px; margin-left: 5%;" />

<div style="margin-right: 5%;">
<p>
Did you enjoy reading this? Click <a href="/random.html">random</a> for more!
</p>

<p>
Russell <a href="/about/">Grows Product</a>, Writes Technical Essays, & <a href="https://media.unturf.com">Documents Permaculture</a>.
<br/>
<br/>
He enjoys casual conversation too! <a href="/contact/">contact russell</a>
</p>

</div>


    {% endblock %}
    </footer>

    <div id="ending_message">
      &copy; {{ AUTHOR }}.
    </div>

  </main>
  {% include "modules/idl.html" %}

  <script>
    function toggleTheme() {
      // Save hash and temporarily remove to prevent jump
      const hash = window.location.hash;
      if (hash) {
        history.replaceState(null, null, ' ');
      }

      const root = document.documentElement;
      const desktopButton = document.getElementById('theme-toggle');
      const mobileButton = document.getElementById('mobile-theme-toggle');
      const pygmentsDark = document.getElementById('pygments-dark');
      const pygmentsLight = document.getElementById('pygments-light');

      if (root.classList.contains('light-mode')) {
        root.classList.remove('light-mode');
        if (desktopButton) desktopButton.textContent = 'Light';
        if (mobileButton) mobileButton.textContent = 'Light';
        localStorage.setItem('theme', 'dark');
        // Switch to dark mode syntax highlighting
        pygmentsDark.disabled = false;
        pygmentsLight.disabled = true;
      } else {
        root.classList.add('light-mode');
        if (desktopButton) desktopButton.textContent = 'Dark';
        if (mobileButton) mobileButton.textContent = 'Dark';
        localStorage.setItem('theme', 'light');
        // Switch to light mode syntax highlighting
        pygmentsDark.disabled = true;
        pygmentsLight.disabled = false;
      }

      // Reload Remarkbox iframe with new theme mode
      const remarkboxIframe = document.getElementById('remarkbox-iframe');
      if (remarkboxIframe) {
        const currentSrc = remarkboxIframe.src;
        const newMode = localStorage.getItem('theme') || 'dark';
        const newModeParam = (newMode === 'dark') ? 'mode=dark' : 'mode=light';

        // Replace existing mode parameter or add it
        let newSrc;
        if (currentSrc.includes('mode=')) {
          newSrc = currentSrc.replace(/mode=(dark|light)/, newModeParam);
        } else {
          const separator = currentSrc.includes('?') ? '&' : '?';
          newSrc = currentSrc.split('#')[0] + separator + newModeParam + (currentSrc.includes('#') ? '#' + currentSrc.split('#')[1] : '');
        }

        remarkboxIframe.src = newSrc;
      }

      // Restore hash without jumping
      if (hash) {
        history.replaceState(null, null, hash);
      }
    }

    // Update button text immediately when they're available
    (function() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        // Buttons are now in DOM, update them immediately
        const desktopButton = document.getElementById('theme-toggle');
        const mobileButton = document.getElementById('mobile-theme-toggle');
        if (desktopButton) desktopButton.textContent = 'Dark';
        if (mobileButton) mobileButton.textContent = 'Dark';
      }
    })();
  </script>
</body>
</html>
